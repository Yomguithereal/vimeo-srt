/*
 *  Project: Vimeo Srt Plugin
 *  Description: A simplistic jQuery plugin to display srt subtitles with vimeo
 *  embedded videos.
 *  Author: PLIQUE Guillaume (Yomguithereal)
 *  Dependancies : -- Froogaloop API --
 *               : -- jQuery --
 *  License: MIT
 */
(function(d,a,f,g,b){var h="vimeoSrt",c={srt:"sample.srt"};function i(l,k){this.element=l;this.options=d.extend({},c,k);this._defaults=c;this._name="vimeoSrt";
this._srt=[];this._currentSecond=0;this._currentStep=false;this._$iframe=false;this._$subtitles=false;this._spaces=new RegExp("\n\n|\r\n\r\n|\r\r","g");
this._carriages=new RegExp("\n|\r\n|\r","g");this.init();}function e(m){var l=m.split(",");var k=parseInt(l[1]);var o=l[0].split(":");var n=(parseInt(o[0])*60*60)+(parseInt(o[1])*60)+(parseInt(o[2]));
return parseFloat(n+"."+k);}function j(m,l){var k=m.map(function(n){return[n,Math.abs(n.seconds_median-l)];});return k.reduce(function(n,o){return(n[1]<o[1])?n:o;
},[-1,999])[0];}i.prototype={init:function(){var k=this;this._$iframe=d(this.element);this._$iframe.load(l);function l(){d.get(k.options.srt,function(n){k._$iframe.after('<div id="'+k.element.getAttribute("id")+'_subtitles">&nbsp;</div>');
k._$subtitles=d("#"+k.element.getAttribute("id")+"_subtitles");k.parseSrt(n);m();});}function m(){var o=a(k.element.getAttribute("id"));o.addEvent("ready",function(){o.addEvent("playProgress",n);
});function n(q,r){k._currentSecond=parseFloat(q.seconds);var p=k.findSuitableStep();if(p){if(p.id!==k._currentStep.id){k._currentStep=p;k._$subtitles.html(k._currentStep.text);
}}else{k._$subtitles.html("&nbsp;");}}}},parseSrt:function(l){var k=this;l.split(this._spaces).forEach(function(n){var m=n.split(k._carriages).filter(function(o){return d.trim(o)!="";
});if(m[1]!==b){var n={id:m[0],seconds_begin:e(m[1].split(" --> ")[0]),seconds_end:e(m[1].split(" --> ")[1]),text:m.slice(2).join("<br>")};n.seconds_median=(n.seconds_begin+n.seconds_end)/2;
k._srt.push(n);}});},findSuitableStep:function(){var k=j(this._srt,this._currentSecond);return((k.seconds_begin<=this._currentSecond)&&((k.seconds_end+1)>=this._currentSecond))?k:false;
}};d.fn[h]=function(k){return this.each(function(){if(!d.data(this,"plugin_"+h)){d.data(this,"plugin_"+h,new i(this,k));}});};})(jQuery,Froogaloop,window,document);
