/* Vimeo Srt - A simplistic jQuery plugin to display srt subtitles along with an embedded vimeo video. - Version: 0.1.0 - Author:  Yomguithereal - License: MIT */
!function(a,b,c,d,e){"use strict";function f(b,c){this.element=b,this.options=a.extend({},h,c),this.defaults=h,this.name=g,this.srt=[],this.currentSecond=0,this.currentStep=!1,this.$iframe=!1,this.$subtitles=!1,this.regex={spaces:/\n\n|\r\n\r\n|\r\r/g,carriages:/\n|\r\n|\r/g},this.init()}var g="vimeoSrt",h={srt:"sample.srt"},i={toMilliseconds:function(a){var b=a.split(","),c=+b[1],d=b[0].split(":"),e=3600*+d[0]+60*+d[1]+ +d[2];return e+c/1e3},getClosestStep:function(a,b){var c=a.map(function(a){return[a,Math.abs(a.seconds_median-b)]});return c.reduce(function(a,b){return a[1]<b[1]?a:b},[-1,999])[0]}};f.prototype={init:function(){function c(){function a(a){d.currentSecond=+a.seconds;var b=d._findSuitableStep();b?b.id!==d.currentStep.id&&(d.currentStep=b,d.$subtitles.html(d.currentStep.text)):d.$subtitles.html("&nbsp;")}var c=b(d.$iframe[0]);c.addEvent("ready",function(){c.addEvent("playProgress",a)})}var d=this;this.$iframe=a(this.element),this.$iframe.load(function(){d.load(d.options.srt,function(){c()})})},_parseSrt:function(b){var c=this;b.split(this.regex.spaces).map(function(b){var d=b.split(c.regex.carriages).filter(function(b){return!!a.trim(b)});if(d[1]){var e=d[1].split(" --> "),b={id:d[0],seconds_begin:i.toMilliseconds(e[0]),seconds_end:i.toMilliseconds(e[1]),text:d.slice(2).join("<br>")};b.seconds_median=(b.seconds_begin+b.seconds_end)/2,c.srt.push(b)}})},_findSuitableStep:function(){var a=i.getClosestStep(this.srt,this.currentSecond);return a.seconds_begin<=this.currentSecond&&a.seconds_end+1>=this.currentSecond?a:!1},load:function(b,c){var d=this,e=d.element.getAttribute("id");a.get(b,function(b){d.$subtitles||(d.$iframe.after('<div id="'+e+'_subtitles">&nbsp;</div>'),d.$subtitles=a("#"+e+"_subtitles")),d.srt=[],d._parseSrt(b),a.isFunction(c)&&c()})}},a.fn[g]=function(b){if(b===e||"object"==typeof b)return this.each(function(){a.data(this,"plugin_"+g)||a.data(this,"plugin_"+g,new f(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var c,d=arguments;return this.each(function(){var e=a.data(this,"plugin_"+g);e instanceof f&&"function"==typeof e[b]&&(c=e[b].apply(e,Array.prototype.slice.call(d,1))),"destroy"===b&&a.data(this,"plugin_"+g,null)}),c!==e?c:this}}}(jQuery,Froogaloop,window,document);